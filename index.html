<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Máquina Expendedora</title>
    <style>
        body {
            margin: 0;
            font-family: sans-serif;
            background-image: url('fondo1.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        .contenedor {
            padding: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #qr-container {
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 10px;
        }

        #qr-image {
            width: 60%;
            max-width: 300px;
            margin-bottom: 10px;
        }

        #qr-message {
            font-size: 1.5rem;
            font-weight: bold;
            color: #222;
            text-align: center;
            background: #ffffffc2;
            padding: 10px;
            border-radius: 10px;
        }

        .teclado {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            width: 100%;
            max-width: 500px;
            margin-top: 10px;
        }

        .producto {
            padding: 15px;
            font-size: 1.1rem;
            text-align: center;
            background-color: #f7c59f;
            border: 2px solid #fff;
            border-radius: 15px;
            position: relative;
            cursor: pointer;
            box-shadow: 2px 2px 5px #aaa;
        }

        .producto:hover {
            background-color: #f5b27a;
        }

        .producto-numero {
            position: absolute;
            bottom: 5px;
            left: 8px;
            font-size: 0.8rem;
            color: #555;
        }
    </style>
</head>
<body>
    <div class="contenedor">
        <div id="qr-container">
            <img id="qr-image" src="" alt="QR generado">
            <div id="qr-message">ESCANEA QR EN LA MÁQUINA</div>
        </div>

        <div class="teclado" id="teclado">
            <!-- Productos -->
        </div>
    </div>

    <script>
        const productos = [
            "Coca-Cola", "Papas Fritas", "Galletas", "Agua", "Jugo",
            "Chocolate", "Barra Cereal", "Sandwich", "Té", "Café",
            "Energética", "Helado", "Chicle", "Muffin", "Pan", 
            "Sopa Instantánea", "Turrón", "Yogur", "Gomitas", "Leche",
            "Fruta", "Maní", "Brownie", "Caramelo", "Té Helado"
        ];

        const teclado = document.getElementById('teclado');
        const qrContainer = document.getElementById('qr-container');
        const qrImage = document.getElementById('qr-image');

        productos.forEach((producto, index) => {
            const btn = document.createElement('div');
            btn.className = 'producto';
            btn.innerHTML = `${producto}<div class="producto-numero">${index + 1}</div>`;
            btn.onclick = () => enviarPedido(index + 1);
            teclado.appendChild(btn);
        });

        async function enviarPedido(pedidoId) {
            const telefono = prompt("Ingresa tu número (sin +56):");
            if (!telefono || telefono.length < 8) return alert("Número inválido");

            const data = {
                pedido_id: pedidoId,
                expiracion: 600,
                telefono: "+56" + telefono
            };

            try {
                const res = await fetch("https://flask-wsp.onrender.com/generar_qr", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                });

                if (!res.ok) throw new Error("Error al generar el QR");

                const blob = await res.blob();
                const url = URL.createObjectURL(blob);

                qrImage.src = url;
                qrContainer.style.display = "flex";
            } catch (e) {
                alert("Error: " + e.message);
            }
        }
    </script>
</body>
</html>
